# Animation Merge Tool for Timeline 作業手順書（Phase 11〜17）

**文書バージョン**: 1.2
**作成日**: 2026-01-27
**対象開発計画書**: 開発計画書.md v1.1

---

## 概要

本書は開発計画書のPhase 11〜17（BlendShape対応、FBXエクスポート機能、およびBlendShape FBXエクスポート修正）の具体的な作業手順を定義する。各タスクには一意のIDを割り振り、依存関係と完了基準を明確にする。

---

## タスクID命名規則

- `P{フェーズ番号}-{連番}`: 例）P11-001

---

## Phase 11: BlendShape対応

**目標**: BlendShape（モーフターゲット）アニメーションカーブの対応
**対応要件**: FR-072
**前提**: Phase 10完了

### タスク一覧

| ID | タスク名 | 説明 | 依存 | 成果物 |
|----|----------|------|------|--------|
| P11-001 | BlendShapeカーブ検出機能の設計 | `blendShape.`プレフィックスを持つカーブの検出ロジックを設計 | - | 設計メモ |
| P11-002 | BlendShapeカーブ検出のテスト作成 | BlendShapeカーブを含むAnimationClipを使用した検出テストを作成 | P11-001 | テストコード |
| P11-003 | BlendShapeカーブ検出の実装 | TrackAnalyzerまたはClipMergerにBlendShapeカーブ検出機能を追加 | P11-002 | 実装コード |
| P11-004 | BlendShapeマージ処理のテスト作成 | 複数トラックのBlendShapeカーブをマージするテストを作成 | P11-003 | テストコード |
| P11-005 | BlendShapeマージ処理の実装 | ClipMergerにBlendShapeカーブのマージ処理を追加 | P11-004 | 実装コード |
| P11-006 | BlendShape Override処理のテスト作成 | 同一BlendShapeプロパティのOverride処理テストを作成 | P11-005 | テストコード |
| P11-007 | BlendShape Override処理の実装 | CurveOverriderにBlendShapeカーブのOverride処理を追加 | P11-006 | 実装コード |
| P11-008 | Phase 11 統合テスト | BlendShape対応の統合テストを実行し、全テストがパスすることを確認 | P11-007 | テスト結果 |

---

## Phase 12: FBXエクスポート基盤

**目標**: FBXエクスポート機能の基盤構築
**対応要件**: FR-004, FR-080, NFR-003, NFR-004, ERR-003
**前提**: Phase 11完了

### タスク一覧

| ID | タスク名 | 説明 | 依存 | 成果物 |
|----|----------|------|------|--------|
| P12-001 | FBX Exporterパッケージ調査 | com.unity.formats.fbx のAPI仕様を調査 | - | 調査メモ |
| P12-002 | FbxExportDataクラス設計 | スケルトン・カーブ情報を保持するDTOを設計 | P12-001 | 設計メモ |
| P12-003 | FbxExportDataクラス実装 | Models/FbxExportData.csを作成 | P12-002 | 実装コード |
| P12-004 | パッケージ存在チェック機能のテスト作成 | FBX Exporterパッケージ未インストール時のエラー処理テストを作成 | P12-001 | テストコード |
| P12-005 | パッケージ存在チェック機能の実装 | パッケージの存在確認とエラーダイアログ表示機能を実装 | P12-004 | 実装コード |
| P12-006 | FbxAnimationExporter基本実装のテスト作成 | FBX Exporter APIラッパーの基本テストを作成 | P12-003, P12-005 | テストコード |
| P12-007 | FbxAnimationExporter基本実装 | Infrastructure/FbxAnimationExporter.csの基本機能を実装 | P12-006 | 実装コード |
| P12-008 | ContextMenuHandlerへのFBXオプション追加テスト | コンテキストメニューにFBXエクスポートオプションを追加するテスト | P12-007 | テストコード |
| P12-009 | ContextMenuHandlerへのFBXオプション追加 | 「Export as FBX」メニュー項目を追加 | P12-008 | 実装コード |
| P12-010 | Phase 12 統合テスト | FBXエクスポート基盤の統合テストを実行 | P12-009 | テスト結果 |

---

## Phase 13: スケルトン・Transform出力

**目標**: FBXへのスケルトンおよびTransformアニメーション出力
**対応要件**: FR-081, FR-082, FR-083
**前提**: Phase 12完了

### タスク一覧

| ID | タスク名 | 説明 | 依存 | 成果物 |
|----|----------|------|------|--------|
| P13-001 | スケルトン取得ロジック設計 | Animatorからボーン階層を取得するロジックを設計 | - | 設計メモ |
| P13-002 | スケルトン取得のテスト作成 | Animatorコンポーネントからスケルトンを取得するテストを作成 | P13-001 | テストコード |
| P13-003 | スケルトン取得の実装 | FbxAnimationExporterにスケルトン取得機能を追加 | P13-002 | 実装コード |
| P13-004 | 非スケルトンTransform取得のテスト作成 | スケルトン以外のGameObjectのTransform情報取得テストを作成 | P13-003 | テストコード |
| P13-005 | 非スケルトンTransform取得の実装 | 追加のTransform（プロップ等）の取得機能を実装 | P13-004 | 実装コード |
| P13-006 | Transformカーブ出力のテスト作成 | Position/Rotation/ScaleカーブのFBX出力テストを作成 | P13-005 | テストコード |
| P13-007 | Transformカーブ出力の実装 | Transformアニメーションカーブを FBXに出力する機能を実装 | P13-006 | 実装コード |
| P13-008 | Phase 13 統合テスト | スケルトン・Transform出力の統合テストを実行 | P13-007 | テスト結果 |

---

## Phase 14: Humanoid→Generic変換

**目標**: HumanoidリグからGeneric形式への変換機能
**対応要件**: FR-090, FR-091, FR-092
**前提**: Phase 13完了

### タスク一覧

| ID | タスク名 | 説明 | 依存 | 成果物 |
|----|----------|------|------|--------|
| P14-001 | Humanoidボーンマッピング調査 | HumanBodyBonesとTransformパスのマッピング仕様を調査 | - | 調査メモ |
| P14-002 | HumanoidToGenericConverterクラス設計 | 変換ロジックのクラス設計 | P14-001 | 設計メモ |
| P14-003 | ボーン名→Transformパス変換のテスト作成 | Humanoidボーン名からTransformパスへの変換テストを作成 | P14-002 | テストコード |
| P14-004 | ボーン名→Transformパス変換の実装 | マッピングテーブルと変換ロジックを実装 | P14-003 | 実装コード |
| P14-005 | マッスルカーブ→Rotation変換のテスト作成 | Humanoidマッスルカーブから回転値への変換テストを作成 | P14-004 | テストコード |
| P14-006 | マッスルカーブ→Rotation変換の実装 | マッスルカーブをTransformの回転に変換する機能を実装 | P14-005 | 実装コード |
| P14-007 | ルートモーション変換のテスト作成 | Humanoidルートモーションのエクスポートテストを作成 | P14-006 | テストコード |
| P14-008 | ルートモーション変換の実装 | ルートモーションをTransformカーブとしてエクスポート | P14-007 | 実装コード |
| P14-009 | FbxAnimationExporterとの統合 | HumanoidToGenericConverterをFbxAnimationExporterに統合 | P14-008 | 実装コード |
| P14-010 | Phase 14 統合テスト | Humanoid→Generic変換の統合テストを実行 | P14-009 | テスト結果 |

---

## Phase 15: BlendShapeエクスポート

**目標**: BlendShapeアニメーションのFBXエクスポート対応
**対応要件**: FR-084, ERR-004
**前提**: Phase 14完了

### タスク一覧

| ID | タスク名 | 説明 | 依存 | 成果物 |
|----|----------|------|------|--------|
| P15-001 | FBX BlendShapeエクスポート仕様調査 | FBX Exporterのモーフターゲット出力仕様を調査 | - | 調査メモ |
| P15-002 | BlendShapeカーブ検出（FBX用）のテスト作成 | FBXエクスポート用のBlendShapeカーブ検出テストを作成 | P15-001 | テストコード |
| P15-003 | BlendShapeカーブ検出（FBX用）の実装 | FbxAnimationExporterにBlendShapeカーブ検出機能を追加 | P15-002 | 実装コード |
| P15-004 | BlendShapeカーブFBX出力のテスト作成 | BlendShapeカーブをFBXに出力するテストを作成 | P15-003 | テストコード |
| P15-005 | BlendShapeカーブFBX出力の実装 | BlendShapeアニメーションをFBXに出力する機能を実装 | P15-004 | 実装コード |
| P15-006 | エクスポートデータなしエラー処理のテスト作成 | エクスポート可能なデータがない場合のエラー処理テストを作成 | P15-005 | テストコード |
| P15-007 | エクスポートデータなしエラー処理の実装 | ERR-004に対応するエラーダイアログ表示を実装 | P15-006 | 実装コード |
| P15-008 | Phase 15 統合テスト | BlendShapeエクスポートの統合テストを実行 | P15-007 | テスト結果 |

---

## Phase 16: FBXエクスポート統合・最終調整

**目標**: FBXエクスポート機能の統合テストと全体的な品質向上
**対応要件**: FR-085, FR-086, FR-087, FR-088, CON-004, CON-005
**前提**: Phase 15完了

### タスク一覧

| ID | タスク名 | 説明 | 依存 | 成果物 |
|----|----------|------|------|--------|
| P16-001 | FileNameGenerator FBX対応のテスト作成 | .fbx拡張子・重複回避の連番付与テストを作成 | - | テストコード |
| P16-002 | FileNameGenerator FBX対応の実装 | FileNameGeneratorに.fbx対応を追加 | P16-001 | 実装コード |
| P16-003 | AnimationMergeService FBX統合のテスト作成 | FBXエクスポートをServiceに統合するテストを作成 | P16-002 | テストコード |
| P16-004 | AnimationMergeService FBX統合の実装 | AnimationMergeServiceにFBXエクスポートフローを追加 | P16-003 | 実装コード |
| P16-005 | 全機能統合テストの作成 | .anim出力とFBX出力の両方を含む統合テストを作成 | P16-004 | テストコード |
| P16-006 | 全機能統合テストの実行 | 統合テストを実行し、全テストがパスすることを確認 | P16-005 | テスト結果 |
| P16-007 | エッジケース対応 | 統合テストで発見されたエッジケースの修正 | P16-006 | 修正コード |
| P16-008 | パフォーマンス検証 | 大量カーブ・長時間アニメーションでのパフォーマンス検証 | P16-007 | 検証結果 |
| P16-009 | コードレビュー・リファクタリング | Phase 11〜16のコードレビューと必要なリファクタリング | P16-008 | 修正コード |
| P16-010 | FBXエクスポート使用方法ドキュメント作成 | FBXエクスポート機能の使用方法ドキュメントを作成 | P16-009 | ドキュメント |
| P16-011 | 外部エンジンインポート検証（任意） | Unreal Engine等でのFBXインポート検証（可能な範囲で） | P16-009 | 検証結果 |
| P16-012 | Phase 16 最終確認 | 全要件の充足確認と最終チェック | P16-010 | 完了報告 |

---

## Phase 17: BlendShape FBXエクスポート修正

**目標**: FBXエクスポート時にBlendShapeアニメーションカーブが正しく出力されるよう修正
**対応要件**: FR-084（BlendShapeアニメーション出力）
**前提**: Phase 16完了

### 背景

Phase 15〜16で実装したBlendShape FBXエクスポートにおいて、出力FBXにBlendShapeアニメーションカーブが含まれない不具合が発見された。根本原因は3つ特定されており、P17-001〜P17-004で修正済み。P17-005以降で修正の検証と、必要に応じて低レベルAPIによる代替実装を行う。

### タスク一覧

| ID | タスク名 | 説明 | 依存 | 成果物 |
|----|----------|------|------|--------|
| P17-001 | ExportModelSettingsSerialize設定の追加 | ExportInternal()でExportBlendShapes/AnimateSkinnedMeshを有効化 | - | 実装コード・テスト |
| P17-002 | PrepareHumanoidForExportのBlendShapeカーブ抽出修正 | BlendShapeカーブを空リストではなく実データで初期化 | P17-001 | 実装コード・テスト |
| P17-003 | PrepareTransformCurvesForExportのBlendShapeカーブ抽出修正 | BlendShapeカーブを空リストではなく実データで初期化 | P17-001 | 実装コード・テスト |
| P17-004 | ContextMenuHandler.CreateFbxExportDataの改善 | PrepareAllCurvesForExportを使用するよう変更 | P17-002, P17-003 | 実装コード・テスト |
| P17-005 | GenericリグBlendShape FBXエクスポート検証テスト | GenericリグのBlendShapeカーブを含むAnimationClipのFBXエクスポート検証 | P17-004 | テストコード |
| P17-006 | HumanoidリグBlendShape FBXエクスポート検証テスト | Humanoidリグ+BlendShapeの組み合わせでのFBXエクスポート検証 | P17-004 | テストコード |
| P17-007 | ContextMenuHandler経由エクスポートフロー統合テスト | ContextMenuHandler.CreateFbxExportData経由のフロー全体の統合テスト | P17-004 | テストコード |
| P17-008 | 検証テスト実行と低レベルAPI必要性判定 | P17-005〜007のテストを実行し、BlendShapeがFBXに含まれるか判定 | P17-005, P17-006, P17-007 | 判定結果 |
| P17-009 | Autodesk.Fbx低レベルAPI設計（条件付き） | 調査メモP12-001セクション5.2に基づく低レベルAPI利用設計 | P17-008 | 設計メモ |
| P17-010 | 低レベルAPIによるBlendShape書き込みテスト作成（条件付き） | FbxAnimStack/FbxAnimLayer/FbxAnimCurveを使用した書き込みテスト | P17-009 | テストコード |
| P17-011 | 低レベルAPIによるBlendShape書き込み実装（条件付き） | Autodesk.Fbx APIでBlendShapeアニメーションをFBXに直接書き込む | P17-010 | 実装コード |
| P17-012 | ExportInternal()への低レベルAPI統合（条件付き） | 低レベルBlendShape書き込みをExportInternal()のエクスポートフローに統合 | P17-011 | 実装コード |
| P17-013 | 低レベルAPI統合の検証テスト（条件付き） | P17-012統合後のBlendShape FBXエクスポート検証テスト実行 | P17-012 | テスト結果 |
| P17-014 | Phase 17 最終確認 | 全テストパス確認、一時ファイルクリーンアップ | P17-008 or P17-013 | 完了報告 |

### タスク詳細

#### P17-005: GenericリグBlendShape FBXエクスポート検証テスト

- BlendShapeカーブを含むAnimationClipを作成（Genericリグ）
- FBXにエクスポートし、出力ファイルが正常に生成されることを確認
- 出力FBXを再インポートし、BlendShapeアニメーションデータが存在するか検証
- **対象ファイル**: FbxAnimationExporterTests.cs に新規テストリージョンを追加

#### P17-006: HumanoidリグBlendShape FBXエクスポート検証テスト

- Humanoidリグ設定のAnimatorに対してBlendShapeカーブを含むAnimationClipを作成
- FBXにエクスポートし、Humanoid特有の処理でBlendShapeカーブが失われないことを検証
- 出力FBXを再インポートし、BlendShapeアニメーションデータが存在するか検証
- **対象ファイル**: FbxAnimationExporterTests.cs に新規テストリージョンを追加

#### P17-007: ContextMenuHandler経由エクスポートフロー統合テスト

- MergeResult経由でCreateFbxExportDataを呼び出し、BlendShapeカーブが含まれるFbxExportDataが生成されることを検証
- 生成されたFbxExportDataでFBXエクスポートを実行し、フロー全体が正常動作することを確認
- **対象ファイル**: ContextMenuHandlerTests.cs に新規テストリージョンを追加

#### P17-008: 検証テスト実行と低レベルAPI必要性判定

- P17-005〜007のテストを実行
- **判定基準**:
  - 全テストパス → P17-014へ進む（Phase 17完了）
  - BlendShapeがFBXに含まれないテスト失敗 → P17-009以降（低レベルAPI実装）へ進む
- 判定結果をコミットメッセージまたはドキュメントに記録

#### P17-009: Autodesk.Fbx低レベルAPI設計（条件付き）

- **実施条件**: P17-008で低レベルAPI必要と判定された場合のみ
- 調査メモ_P12-001セクション5.2「代替アプローチ」を参照
- FbxManager, FbxScene, FbxAnimStack, FbxAnimLayer, FbxAnimCurve の利用方針を設計
- ExportInternal()の既存フローへの統合ポイントを特定
- **成果物**: 設計メモ

**調査結果に基づく設計方針**:

1. **二段階エクスポート方式を採用**
   - 第1段階: `ModelExporter.ExportObject()`でTransform/スケルトン/メッシュをエクスポート
   - 第2段階: `Autodesk.Fbx` APIでFBXファイルを再オープンし、BlendShapeカーブを追記

2. **必要なFBX SDK API**:
   ```csharp
   using Autodesk.Fbx;

   // ファイル読み書き
   - FbxManager.Create()
   - FbxIOSettings.Create()
   - FbxImporter / FbxExporter

   // アニメーション構造
   - FbxAnimStack
   - FbxAnimLayer
   - FbxAnimCurve
   - FbxAnimCurveNode

   // BlendShapeアクセス
   - FbxNode.FindChild() - BlendShapeノード検索
   - FbxBlendShapeChannel.DeformPercent - BlendShapeプロパティ取得
   - FbxProperty.GetCurve() - カーブ取得・作成
   ```

3. **統合ポイント**: `ExportInternal()`メソッドの`ModelExporter.ExportObject()`呼び出し直後

4. **asmdef変更**: `AnimationMergeTool.Editor.asmdef`に`Autodesk.Fbx`参照を追加

#### P17-010: 低レベルAPIによるBlendShape書き込みテスト作成（条件付き）

- **実施条件**: P17-008で低レベルAPI必要と判定された場合のみ
- FbxAnimCurveを使用したBlendShapeカーブの書き込みテストを作成
- テスト観点: カーブ値の正確性、複数BlendShapeの同時書き込み、空データの処理
- **対象ファイル**: FbxAnimationExporterTests.cs に新規テストリージョンを追加

**テストケース一覧**:

1. `LowLevelApi_FBXファイルを読み込んでBlendShapeカーブを追加できる()`
   - 既存のFBXファイルを読み込み
   - BlendShapeカーブを追加
   - 再インポートしてカーブが含まれることを確認

2. `LowLevelApi_複数のBlendShapeカーブを同時に書き込める()`
   - Smile、Blinkなど複数のBlendShapeカーブを追加
   - 全てのカーブが正しく保存されることを確認

3. `LowLevelApi_既存のTransformアニメーションを壊さない()`
   - Transformカーブを含むFBXを作成
   - BlendShapeカーブを追記
   - Transformカーブが維持されていることを確認

4. `LowLevelApi_BlendShapeカーブが空の場合は何もしない()`
   - 空のBlendShapeリストで処理を呼び出し
   - エラーなく完了することを確認

#### P17-011: 低レベルAPIによるBlendShape書き込み実装（条件付き）

- **実施条件**: P17-008で低レベルAPI必要と判定された場合のみ
- FbxAnimationExporterに低レベルBlendShape書き込みメソッドを追加
- FbxManager/FbxScene/FbxAnimStack/FbxAnimLayer/FbxAnimCurve を使用
- P17-010のテストがパスすることを確認
- **対象ファイル**: FbxAnimationExporter.cs

**新規メソッド設計**:

```csharp
/// <summary>
/// FBXファイルにBlendShapeアニメーションカーブを追記する
/// </summary>
/// <param name="fbxPath">対象FBXファイルパス</param>
/// <param name="blendShapeCurves">BlendShapeカーブデータ</param>
/// <returns>成功時true</returns>
private bool WriteBlendShapeCurvesToFbx(
    string fbxPath,
    IReadOnlyList<BlendShapeCurveData> blendShapeCurves)
{
    // 1. FbxManagerとIOSettingsを作成
    // 2. FbxImporterでFBXファイルを読み込み
    // 3. 既存のFbxAnimStackを取得（なければ作成）
    // 4. FbxAnimLayerを取得または作成
    // 5. 各BlendShapeCurveDataに対して:
    //    - 対応するFbxNodeを検索
    //    - BlendShapeChannelからDeformPercentプロパティを取得
    //    - FbxProperty.GetCurve()でカーブを作成
    //    - キーフレームを設定
    // 6. FbxExporterでファイルを保存
    // 7. リソースをDispose
}
```

**エラーハンドリング**:
- FBXファイルが存在しない場合: ログ出力してfalse返却
- BlendShapeノードが見つからない場合: 警告ログ出力して該当カーブをスキップ
- ファイル書き込み失敗: 例外キャッチしてfalse返却

#### P17-012: ExportInternal()への低レベルAPI統合（条件付き）

- **実施条件**: P17-008で低レベルAPI必要と判定された場合のみ
- ExportInternal()のエクスポートフロー内で、ModelExporter.ExportObject()呼び出し後に低レベルAPIでBlendShapeカーブを追記
- 既存のTransformアニメーション出力を壊さないことを確認
- **対象ファイル**: FbxAnimationExporter.cs

**変更箇所**: `FbxAnimationExporter.ExportInternal()`

```csharp
// 既存コード（257行目付近）
string result = ModelExporter.ExportObject(outputPath, exportTarget);

// ↓ 以下を追加
// BlendShapeカーブの低レベルAPI書き込み
if (!string.IsNullOrEmpty(result) && exportData.BlendShapeCurves?.Count > 0)
{
    var blendShapeWriteSuccess = WriteBlendShapeCurvesToFbx(
        outputPath,
        exportData.BlendShapeCurves);

    if (!blendShapeWriteSuccess)
    {
        Debug.LogWarning(
            $"BlendShapeアニメーションの書き込みに失敗しました: {outputPath}");
    }
}
```

**回帰テスト確認項目**:
- 既存のTransformのみエクスポートテストが引き続きパスすること
- Humanoid→Generic変換テストが引き続きパスすること
- スケルトンエクスポートテストが引き続きパスすること

#### P17-013: 低レベルAPI統合の検証テスト（条件付き）

- **実施条件**: P17-008で低レベルAPI必要と判定された場合のみ
- P17-005〜007と同等の検証テストを低レベルAPI統合後に再実行
- Genericリグ・Humanoidリグ両方でBlendShapeがFBXに含まれることを確認

#### P17-014: Phase 17 最終確認

- 全テストがパスすることを確認
- 一時ファイル（ログ、テスト結果XML、バッチファイル等）のクリーンアップ
- 完了報告

---

## タスク依存関係図

```
Phase 11: BlendShape対応
P11-001 → P11-002 → P11-003 → P11-004 → P11-005 → P11-006 → P11-007 → P11-008
                                                                          │
                                                                          ▼
Phase 12: FBXエクスポート基盤
P12-001 ─┬→ P12-002 → P12-003 ─┐
         │                      │
         └→ P12-004 → P12-005 ─┴→ P12-006 → P12-007 → P12-008 → P12-009 → P12-010
                                                                              │
                                                                              ▼
Phase 13: スケルトン・Transform出力
P13-001 → P13-002 → P13-003 → P13-004 → P13-005 → P13-006 → P13-007 → P13-008
                                                                          │
                                                                          ▼
Phase 14: Humanoid→Generic変換
P14-001 → P14-002 → P14-003 → P14-004 → P14-005 → P14-006 → P14-007 → P14-008 → P14-009 → P14-010
                                                                                              │
                                                                                              ▼
Phase 15: BlendShapeエクスポート
P15-001 → P15-002 → P15-003 → P15-004 → P15-005 → P15-006 → P15-007 → P15-008
                                                                          │
                                                                          ▼
Phase 16: FBXエクスポート統合・最終調整
P16-001 → P16-002 → P16-003 → P16-004 → P16-005 → P16-006 → P16-007 → P16-008 → P16-009 ─┬→ P16-010 → P16-012
                                                                                          │
                                                                                          └→ P16-011 ─────┘
                                                                                                          │
                                                                                                          ▼
Phase 17: BlendShape FBXエクスポート修正
P17-001 ─┬→ P17-002 ─┐
         │           ├→ P17-004 → P17-005 ─┐
         └→ P17-003 ─┘            P17-006 ─┼→ P17-008 ─┬→ P17-014（成功時）
                                  P17-007 ─┘           │
                                                       └→ P17-009 → P17-010 → P17-011 → P17-012 → P17-013 → P17-014（低レベルAPI時）
```

---

## 完了基準チェックリスト

### Phase 11 完了基準
- [ ] P11-001〜P11-008 全タスク完了
- [ ] FR-072（BlendShapeアニメーションカーブ対応）が実装されている
- [ ] BlendShapeカーブの検出・マージ・Override処理が正しく動作する
- [ ] 単体テストが全てパスする

### Phase 12 完了基準
- [ ] P12-001〜P12-010 全タスク完了
- [ ] FR-004, FR-080が実装されている
- [ ] NFR-003（FBX Exporterパッケージ依存）が満たされている
- [ ] NFR-004（パッケージ未インストール時のメッセージ表示）が満たされている
- [ ] ERR-003（FBX Exporterパッケージ未インストールエラー）が実装されている
- [ ] 単体テストが全てパスする

### Phase 13 完了基準
- [ ] P13-001〜P13-008 全タスク完了
- [ ] FR-081〜FR-083が実装されている
- [ ] スケルトン階層がFBXに正しく出力される
- [ ] Transformアニメーションがエクスポートされる
- [ ] 単体テストが全てパスする

### Phase 14 完了基準
- [ ] P14-001〜P14-010 全タスク完了
- [ ] FR-090〜FR-092が実装されている
- [ ] Humanoidボーン名→Transformパスの変換が正しく動作する
- [ ] マッスルカーブ→Rotation変換が正しく動作する
- [ ] ルートモーションがエクスポートされる
- [ ] 単体テストが全てパスする

### Phase 15 完了基準
- [ ] P15-001〜P15-008 全タスク完了
- [ ] FR-084が実装されている
- [ ] ERR-004（エクスポート可能データなしエラー）が実装されている
- [ ] BlendShapeアニメーションがFBXに正しく出力される
- [ ] 単体テストが全てパスする

### Phase 16 完了基準
- [ ] P16-001〜P16-012 全タスク完了
- [ ] FR-085〜FR-088が実装されている
- [ ] CON-004, CON-005が適切に処理されている
- [ ] 統合テストが全てパスする
- [ ] 使用方法ドキュメントが作成されている
- [ ] FBXエクスポート関連の単体テストカバレッジ80%以上

### Phase 17 完了基準
- [ ] P17-001〜P17-004 全タスク完了（修正実装）
- [ ] P17-005〜P17-007 検証テスト作成完了
- [ ] P17-008 検証テスト実行・判定完了
- [ ] BlendShapeカーブを含むAnimationClipのFBXエクスポートで、出力FBXにBlendShapeアニメーションが含まれること
- [ ] Humanoidリグ+BlendShapeの組み合わせで正しくエクスポートされること
- [ ] （P17-006条件成立時）低レベルAPIによるBlendShapeアニメーション書き込みが正しく動作すること
- [ ] 単体テスト・検証テストが全てパスすること
- [ ] 一時ファイルがクリーンアップされていること

---

## 備考

- 各タスクはTDD（テスト駆動開発）で進める
- テスト作成タスクは実装タスクの前に完了させる
- 調査・設計タスクは必要に応じてドキュメントを残す
- 統合テストでは実際のTimelineアセットを使用した検証を行う

---

## 更新履歴

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| 1.0 | 2026-01-27 | 初版作成 |
| 1.1 | 2026-01-27 | Phase 17追加（P17-004以降のタスク分割） |
| 1.2 | 2026-01-29 | P17-009〜P17-012詳細追記（Autodesk.Fbx低レベルAPI設計・テスト・実装・統合） |
