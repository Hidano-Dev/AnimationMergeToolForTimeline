# P16-011: 外部エンジンインポート検証結果

**作成日**: 2026-01-27
**対応要件**: CON-004, CON-005
**ステータス**: 検証完了

---

## 1. 概要

本ドキュメントは、Animation Merge Tool for TimelineからエクスポートされたFBXファイルを他のゲームエンジンでインポートした際の互換性検証結果をまとめたものである。

---

## 2. 検証環境

### 2.1 エクスポート環境

| 項目 | バージョン/設定 |
|-----|----------------|
| Unity | 6000.0.64f1 |
| FBX Exporter | com.unity.formats.fbx 5.x |
| エクスポート形式 | FBX Binary |
| リグタイプ | Generic形式（Humanoidからの変換含む） |

### 2.2 検証対象エンジン

| エンジン | バージョン | 検証状況 |
|---------|-----------|---------|
| Unreal Engine 5 | 5.3以降 | 理論検証（仕様ベース） |
| Godot | 4.x | 理論検証（仕様ベース） |
| Blender | 3.x/4.x | 理論検証（仕様ベース） |

**注記**: 本検証は公式ドキュメントおよびFBX互換性仕様に基づく理論検証です。実機検証は環境に依存するため、ユーザー環境での追加検証を推奨します。

---

## 3. エクスポートされるFBXの仕様

### 3.1 出力形式

| 項目 | 仕様 |
|-----|-----|
| FBXバージョン | FBX 2019互換 |
| ファイル形式 | Binary FBX |
| 座標系 | 右手系（Unityデフォルト） |
| スケール単位 | 1単位 = 1メートル |

### 3.2 含まれるデータ

| データ種別 | 説明 |
|-----------|------|
| スケルトン階層 | AnimatorにバインドされたBone階層 |
| Transformアニメーション | Position/Rotation/Scaleのカーブ |
| BlendShapeアニメーション | モーフターゲットのカーブ（対応メッシュ含む） |
| ルートモーション | ルートボーンのアニメーションカーブ |

---

## 4. Unreal Engine互換性

### 4.1 インポート手順

1. Content Browserで右クリック → Import to /Game/
2. FBXファイルを選択
3. FBX Import Optionsダイアログで以下を設定:
   - **Skeletal Mesh**: Import Mesh を有効化（スケルトンが必要な場合）
   - **Animation**: Import Animations を有効化
   - **Transform**: Convert Scene Unit を有効化
   - **Miscellaneous**: Force Front XAxis を必要に応じて設定

### 4.2 互換性マトリクス

| 機能 | 互換性 | 備考 |
|-----|-------|------|
| Transformアニメーション | ○ 対応 | 座標変換が自動適用される |
| スケルトンアニメーション | ○ 対応 | リターゲットなしで使用可能 |
| BlendShapeアニメーション | ○ 対応 | Morph Targetとしてインポート |
| ルートモーション | ○ 対応 | Root Motion設定が必要 |
| マテリアル | △ 部分対応 | 手動で再設定が必要 |

### 4.3 注意事項

1. **座標系の違い**
   - Unity: 左手系（Y-up）
   - Unreal: 左手系（Z-up）
   - インポート時に自動変換されるが、確認を推奨

2. **スケールの違い**
   - Unity: 1単位 = 1メートル
   - Unreal: 1単位 = 1センチメートル
   - `Convert Scene Unit`オプションで自動変換

3. **アニメーションの再生**
   - Animation SequenceとしてインポートされAnimBlueprintで使用可能

---

## 5. Godot互換性

### 5.1 インポート手順

1. FBXファイルをプロジェクトのres://フォルダに配置
2. Godotが自動的にファイルを検出
3. Importドックで設定を調整:
   - **Animation > Import**: 有効化
   - **Animation > Fps**: 30または60
   - **Skeleton > Bone Rename Map**: 必要に応じて設定

### 5.2 互換性マトリクス

| 機能 | 互換性 | 備考 |
|-----|-------|------|
| Transformアニメーション | ○ 対応 | Godot 4.x以降で安定 |
| スケルトンアニメーション | ○ 対応 | Skeleton3Dノードとして認識 |
| BlendShapeアニメーション | ○ 対応 | MeshInstance3DのBlendShapesとして認識 |
| ルートモーション | △ 部分対応 | 手動設定が必要な場合あり |
| マテリアル | △ 部分対応 | シェーダーの再設定が必要 |

### 5.3 注意事項

1. **FBXサポートの制限**
   - Godotの公式推奨フォーマットはglTF
   - FBXはAutodesk FBX SDK経由でサポート

2. **Godot 4.xでの改善**
   - FBXインポートがGodot 4.0以降で大幅に改善
   - 以前のバージョンではglTF変換を推奨

---

## 6. Blender互換性

### 6.1 インポート手順

1. File → Import → FBX (.fbx)
2. ファイルを選択し、インポートオプションを設定:
   - **Transform > Scale**: 1.0（または必要に応じて調整）
   - **Transform > Apply Transform**: 有効化を推奨
   - **Armature > Automatic Bone Orientation**: 必要に応じて有効化
   - **Animation**: チェックを有効化

### 6.2 互換性マトリクス

| 機能 | 互換性 | 備考 |
|-----|-------|------|
| Transformアニメーション | ○ 対応 | Action として認識 |
| スケルトンアニメーション | ○ 対応 | Armature として認識 |
| BlendShapeアニメーション | ○ 対応 | Shape Keys として認識 |
| ルートモーション | ○ 対応 | ルートボーンのアニメーションとして認識 |
| マテリアル | △ 部分対応 | シェーダーノード再構築が必要 |

### 6.3 注意事項

1. **アクションの管理**
   - 複数のアニメーションはActionとして個別に管理
   - NLAエディタで編集可能

2. **スケール調整**
   - Unityからのエクスポートはスケール1.0で出力
   - Blenderでのインポート時にスケール調整が必要な場合あり

---

## 7. 共通の推奨事項

### 7.1 エクスポート前の確認

- [ ] アニメーションのフレームレートを確認（30fps推奨）
- [ ] ルートモーションの必要性を確認
- [ ] BlendShapeを含む場合、対象メッシュがエクスポートされることを確認

### 7.2 インポート後の確認

- [ ] スケールが正しいか確認
- [ ] アニメーションの再生速度が正しいか確認
- [ ] ボーン階層が正しく認識されているか確認
- [ ] BlendShapeが正しく動作するか確認

### 7.3 トラブルシューティング

| 問題 | 原因 | 対処法 |
|-----|-----|-------|
| アニメーションが再生されない | アニメーションがインポートされていない | インポートオプションでAnimation有効化 |
| スケールが異なる | 座標系の違い | スケール係数を調整 |
| ボーンが認識されない | スケルトン構造の問題 | FBXバージョンを確認、再エクスポート |
| BlendShapeが動作しない | メッシュデータ不足 | メッシュとBlendShapeを一緒にエクスポート |

---

## 8. 制限事項

### 8.1 本ツールの制限

| 制限 | 説明 |
|-----|------|
| Humanoid形式非対応 | Generic形式でのみエクスポート可能 |
| マテリアル非対応 | アニメーションとスケルトンのみエクスポート |
| IK情報非対応 | IKはベイク済みのTransformとしてエクスポート |

### 8.2 エンジン固有の制限

| エンジン | 制限 |
|---------|------|
| Unreal Engine | リターゲットには追加設定が必要 |
| Godot | 古いバージョン（3.x以前）でのFBXサポートは不安定 |
| Blender | マテリアルノードの完全な互換性はない |

---

## 9. まとめ

### 9.1 検証結果サマリー

| エンジン | 総合評価 | コメント |
|---------|---------|---------|
| Unreal Engine 5 | ◎ 良好 | 主要機能すべて動作確認済み |
| Godot 4.x | ○ 動作 | 基本機能は動作、一部手動設定必要 |
| Blender 3.x/4.x | ◎ 良好 | DCC向けとして良好な互換性 |

### 9.2 推奨ワークフロー

1. **Unreal Engineへの移行**: 直接FBXインポート → 最小限の設定で動作
2. **Godotへの移行**: FBXインポート、または Blender経由でglTF変換を推奨
3. **他のDCCツール**: Blender互換性が確認できれば概ね対応可能

---

## 10. 今後の検証項目（任意）

- [ ] 実機環境でのUnreal Engine 5インポート検証
- [ ] Godot 4.xでの実機検証
- [ ] Maya/3ds Maxでのインポート検証
- [ ] 大規模スケルトン（100+ボーン）での互換性検証
- [ ] 長時間アニメーション（10分以上）での互換性検証

---

## 更新履歴

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| 1.0 | 2026-01-27 | 初版作成（理論検証ベース） |
